# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.0 â†’ v2.1 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æŒ‡ç¤ºæ›¸
# CULOchanSEISANshoï¼ˆäº¤é€šè²»ç²¾ç®—æ›¸ï¼‰ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ—ã«çµ±åˆã™ã‚‹
# å¯¾è±¡ãƒªãƒã‚¸ãƒˆãƒª: maintenance-map-ap

## ä½œæ¥­æ¦‚è¦
ä¸‹éƒ¨ãƒ‘ãƒãƒ«ã«ã€ŒğŸ’° ç²¾ç®—æ›¸ã€ã‚¿ãƒ–ã‚’è¿½åŠ ã—ã€äº¤é€šè²»ç²¾ç®—æ›¸ã®ä½œæˆãƒ»PDFå‡ºåŠ›ãƒ»ä¸‹æ›¸ãç®¡ç†æ©Ÿèƒ½ã‚’çµ±åˆã™ã‚‹ã€‚
æ—¢å­˜ã®ãƒãƒƒãƒ—æ©Ÿèƒ½ã¯ä¸€åˆ‡å¤‰æ›´ã—ãªã„ã€‚

---

## ä½œæ¥­1: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ â€” expense-styles.css

ç²¾ç®—æ›¸ã‚¿ãƒ–å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã€‚ä»¥ä¸‹ã®å†…å®¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```css
/* ============================================
 * ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.1 - expense-styles.css
 * äº¤é€šè²»ç²¾ç®—æ›¸ã‚¿ãƒ–å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«
 * v2.1æ–°è¦ä½œæˆ - CULOchanSEISANshoçµ±åˆ
 * è¦ªCSSã®å¤‰æ•°(--primaryç­‰)ã‚’æ´»ç”¨ã—ã¦çµ±ä¸€æ„Ÿã‚’ç¶­æŒ
 * ============================================ */

:root {
    --exp-accent: #0d7377;
    --exp-accent-light: #14919b;
    --exp-accent-bg: #e6f7f7;
    --exp-accent-glow: rgba(13, 115, 119, 0.15);
}

.exp-panel { padding: 8px 4px 24px; }

.exp-section {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 12px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
}

.exp-section-title {
    font-size: 13px; font-weight: 700; color: var(--exp-accent);
    margin-bottom: 10px; padding-bottom: 6px;
    border-bottom: 2px solid var(--exp-accent);
}

.exp-form-grid { display: flex; gap: 8px; margin-bottom: 6px; }
.exp-field { flex: 1; min-width: 0; }
.exp-field-sm { flex: 0 0 60px; min-width: 60px; }
.exp-field-grow { flex: 2; }

.exp-field label {
    display: block; font-size: 11px; font-weight: 600;
    color: var(--text-light); margin-bottom: 3px;
}

.exp-field input,
.exp-field select,
.exp-field textarea {
    width: 100%; padding: 8px 10px;
    border: 1.5px solid var(--border); border-radius: 8px;
    font-size: 14px; font-family: var(--font);
    outline: none; background: var(--surface);
    transition: border-color 0.2s, box-shadow 0.2s;
}

.exp-field input:focus,
.exp-field textarea:focus {
    border-color: var(--exp-accent);
    box-shadow: 0 0 0 3px var(--exp-accent-glow);
}

.exp-field input[readonly] {
    background: var(--exp-accent-bg); color: var(--exp-accent); font-weight: 600;
}

.exp-field textarea { resize: vertical; min-height: 48px; }

.exp-etc-btn {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    width: 100%; padding: 12px; margin-bottom: 10px;
    background: linear-gradient(135deg, #ff6b35, #f7931e);
    color: white; border: none; border-radius: var(--radius);
    font-size: 14px; font-weight: 700; font-family: var(--font);
    text-decoration: none; cursor: pointer;
    box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
    transition: transform 0.15s, box-shadow 0.15s;
}
.exp-etc-btn:active { transform: scale(0.98); box-shadow: 0 1px 4px rgba(255, 107, 53, 0.2); }

.exp-row {
    background: var(--bg); border-radius: var(--radius);
    padding: 12px; margin-bottom: 10px;
    border-left: 3px solid var(--exp-accent);
    transition: box-shadow 0.2s;
}
.exp-row:last-child { margin-bottom: 0; }

.exp-row-head {
    display: flex; justify-content: space-between;
    align-items: center; margin-bottom: 10px;
}

.exp-row-num {
    display: flex; align-items: center; justify-content: center;
    width: 28px; height: 28px; border-radius: 50%;
    background: var(--exp-accent); color: white;
    font-size: 13px; font-weight: 700;
}

.exp-row-del {
    width: 28px; height: 28px; border-radius: 50%;
    background: var(--danger); color: white; border: none;
    font-size: 14px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
}
.exp-row-del:active { background: #b91c1c; }

.exp-row-total {
    text-align: right; margin-top: 8px;
    font-size: 13px; font-weight: 700; color: var(--exp-accent);
}
.exp-row-total-val { font-size: 15px; }

.exp-add-row-btn {
    width: 100%; padding: 10px; margin-top: 10px;
    background: var(--exp-accent); color: white; border: none;
    border-radius: var(--radius); font-size: 14px; font-weight: 700;
    font-family: var(--font); cursor: pointer; transition: background 0.15s;
}
.exp-add-row-btn:active { background: var(--exp-accent-light); }

.exp-hint { font-size: 11px; color: var(--text-light); text-align: center; margin-top: 6px; }

.exp-total-card {
    background: linear-gradient(135deg, var(--exp-accent), var(--exp-accent-light));
    color: white; padding: 16px; border-radius: var(--radius);
    text-align: center; margin-bottom: 10px;
    box-shadow: 0 4px 12px rgba(13, 115, 119, 0.3);
}
.exp-total-label { font-size: 12px; opacity: 0.9; }
.exp-total-amount { font-size: 28px; font-weight: 900; letter-spacing: 1px; margin-top: 4px; }

.exp-actions { display: flex; gap: 8px; margin-bottom: 10px; }

.exp-btn {
    flex: 1; padding: 11px 8px; border: none;
    border-radius: var(--radius); font-size: 13px; font-weight: 700;
    font-family: var(--font); cursor: pointer; transition: transform 0.15s;
}
.exp-btn:active { transform: scale(0.97); }
.exp-btn-pdf { background: var(--success); color: white; }
.exp-btn-save { background: var(--warning); color: #333; }
.exp-btn-clear { background: #6c757d; color: white; }

.exp-draft-list { margin-top: 4px; }

.exp-draft-item {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--bg); padding: 10px 12px; border-radius: 8px;
    margin-bottom: 6px; transition: background 0.15s;
}
.exp-draft-item:active { background: var(--border); }

.exp-draft-info { flex: 1; cursor: pointer; min-width: 0; }

.exp-draft-title {
    font-size: 13px; font-weight: 600;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.exp-draft-date { font-size: 11px; color: var(--text-light); margin-top: 2px; }

.exp-draft-del {
    background: var(--danger); color: white; border: none;
    padding: 5px 10px; border-radius: 6px; font-size: 12px;
    cursor: pointer; flex-shrink: 0; margin-left: 8px;
}
.exp-draft-del:active { background: #b91c1c; }
```

---

## ä½œæ¥­2: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ â€” expense-form.js

ç²¾ç®—æ›¸ãƒ•ã‚©ãƒ¼ãƒ UIãƒ»è¨ˆç®—ãƒ»ä¸‹æ›¸ãç®¡ç†ã€‚ä»¥ä¸‹ã®å†…å®¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```javascript
// ============================================
// ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.1 - expense-form.js
// äº¤é€šè²»ç²¾ç®—æ›¸ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ä¸‹æ›¸ãç®¡ç†
// v2.1æ–°è¦ä½œæˆ - CULOchanSEISANshoã‹ã‚‰çµ±åˆ
// PDFç”Ÿæˆã¯expense-pdf.jsã«å§”è­²
// ============================================

const ExpenseForm = (() => {
    let rowCount = 0;
    let initialized = false;

    // v2.1 - ç²¾ç®—æ›¸ã‚¿ãƒ–ã®åˆæœŸåŒ–
    function init() {
        if (!initialized) {
            renderExpensePanel();
            initialized = true;
        }
        loadDraftList();
    }

    // v2.1 - ç²¾ç®—æ›¸ãƒ‘ãƒãƒ«ã®HTMLç”Ÿæˆ
    function renderExpensePanel() {
        const container = document.getElementById('tabExpense');
        if (!container) return;

        container.innerHTML = `
            <div class="exp-panel">
                <div class="exp-section">
                    <div class="exp-section-title">ğŸ“‹ åŸºæœ¬æƒ…å ±</div>
                    <div class="exp-form-grid">
                        <div class="exp-field">
                            <label>æå‡ºæ—¥</label>
                            <input type="date" id="expSubmitDate">
                        </div>
                        <div class="exp-field">
                            <label>SSå</label>
                            <input type="text" id="expSsName" value="åƒè‘‰è¥¿SS">
                        </div>
                    </div>
                    <div class="exp-field" style="margin-top:8px;">
                        <label>è¡Œå…ˆï¼ˆãŠå®¢æ§˜åï¼‰</label>
                        <textarea id="expDestination" rows="2"
                            placeholder="é€—å­å¸‚&#10;ã‚¯ãƒ©ãƒ•ãƒ†ã‚£åŒ—æ‘"></textarea>
                    </div>
                    <div class="exp-field" style="margin-top:8px;">
                        <label>æ°å</label>
                        <input type="text" id="expEmployeeName" value="å°å‡ºæ™ƒä¹Ÿ">
                    </div>
                </div>

                <a href="https://www.etc-meisai.jp/" target="_blank"
                   class="exp-etc-btn">
                    ğŸ›£ï¸ ETCåˆ©ç”¨ç…§ä¼šã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã
                </a>

                <div class="exp-section">
                    <div class="exp-section-title">ğŸšƒ äº¤é€šè²»æ˜ç´°</div>
                    <div id="expRows"></div>
                    <button class="exp-add-row-btn"
                        onclick="ExpenseForm.addRow()">
                        â• è¡Œã‚’è¿½åŠ 
                    </button>
                    <p class="exp-hint">
                        ğŸ’¡ èµ°è¡Œè·é›¢100kmä»¥ä¸Šã§ã‚¬ã‚½ãƒªãƒ³ä»£è‡ªå‹•è¨ˆç®—</p>
                </div>

                <div class="exp-total-card">
                    <div class="exp-total-label">åˆè¨ˆé‡‘é¡</div>
                    <div class="exp-total-amount" id="expGrandTotal">Â¥0</div>
                </div>

                <div class="exp-actions">
                    <button class="exp-btn exp-btn-pdf"
                        onclick="ExpenseForm.generatePDF()">
                        ğŸ“„ PDFå‡ºåŠ›</button>
                    <button class="exp-btn exp-btn-save"
                        onclick="ExpenseForm.saveDraft()">
                        ğŸ’¾ ä¸‹æ›¸ãä¿å­˜</button>
                    <button class="exp-btn exp-btn-clear"
                        onclick="ExpenseForm.clearAll()">
                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                </div>

                <div class="exp-section">
                    <div class="exp-section-title">ğŸ“ ä¸‹æ›¸ãä¸€è¦§</div>
                    <div id="expDraftList" class="exp-draft-list">
                        <p class="empty-msg">ä¸‹æ›¸ãã¯ã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('expSubmitDate').value =
            new Date().toISOString().split('T')[0];
        rowCount = 0;
        addRow();
    }

    // v2.1 - æ˜ç´°è¡Œã‚’è¿½åŠ 
    function addRow() {
        rowCount++;
        const container = document.getElementById('expRows');
        if (!container) return;

        const row = document.createElement('div');
        row.className = 'exp-row';
        row.id = `expRow-${rowCount}`;
        const num = rowCount;

        row.innerHTML = `
            <div class="exp-row-head">
                <span class="exp-row-num">${num}</span>
                <button class="exp-row-del"
                    onclick="ExpenseForm.deleteRow(${num})">âœ•</button>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field exp-field-sm">
                    <label>æœˆ</label>
                    <input type="number" class="exp-month"
                        placeholder="2" min="1" max="12">
                </div>
                <div class="exp-field exp-field-sm">
                    <label>æ—¥</label>
                    <input type="number" class="exp-day"
                        placeholder="21" min="1" max="31">
                </div>
                <div class="exp-field exp-field-grow">
                    <label>äº¤é€šæ©Ÿé–¢</label>
                    <input type="text" class="exp-transport"
                        placeholder="é«˜é€Ÿé“è·¯">
                </div>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field">
                    <label>èµ°è¡Œè·é›¢(km)</label>
                    <input type="number" class="exp-distance"
                        placeholder="186"
                        onchange="ExpenseForm.updateGas(this)">
                </div>
                <div class="exp-field">
                    <label>ã‚¬ã‚½ãƒªãƒ³ä»£</label>
                    <input type="number" class="exp-gas"
                        placeholder="è‡ªå‹•" readonly>
                </div>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field exp-field-grow">
                    <label>é«˜é€Ÿä»£ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šå¯ï¼‰</label>
                    <input type="text" class="exp-highway"
                        placeholder="5110"
                        onchange="ExpenseForm.calcTotals()">
                </div>
                <div class="exp-field exp-field-sm">
                    <label>æšæ•°</label>
                    <input type="number" class="exp-hw-count"
                        placeholder="8">
                </div>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field">
                    <label>ãã®ä»–</label>
                    <input type="number" class="exp-other"
                        placeholder="0"
                        onchange="ExpenseForm.calcTotals()">
                </div>
                <div class="exp-field">
                    <label>èˆ¹è³ƒ</label>
                    <input type="number" class="exp-ship"
                        placeholder="0"
                        onchange="ExpenseForm.calcTotals()">
                </div>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field">
                    <label>é›»è»Šè³ƒ</label>
                    <input type="number" class="exp-train"
                        placeholder="0"
                        onchange="ExpenseForm.calcTotals()">
                </div>
                <div class="exp-field">
                    <label>èˆªç©ºè³ƒ</label>
                    <input type="number" class="exp-air"
                        placeholder="0"
                        onchange="ExpenseForm.calcTotals()">
                </div>
            </div>
            <div class="exp-form-grid">
                <div class="exp-field">
                    <label>å®¿æ³Šæ–™</label>
                    <input type="number" class="exp-hotel"
                        placeholder="0"
                        onchange="ExpenseForm.calcTotals()">
                </div>
                <div class="exp-field">
                    <label>å®¿æ³Šå…ˆ</label>
                    <input type="text" class="exp-hotel-name"
                        placeholder="">
                </div>
            </div>
            <div class="exp-row-total">
                è¡Œåˆè¨ˆ: <span class="exp-row-total-val">Â¥0</span>
            </div>
        `;
        container.appendChild(row);
        updateRowNumbers();
    }

    // v2.1 - è¡Œã‚’å‰Šé™¤
    function deleteRow(id) {
        const row = document.getElementById(`expRow-${id}`);
        const allRows = document.querySelectorAll('.exp-row');
        if (row && allRows.length > 1) {
            row.remove();
            updateRowNumbers();
            calcTotals();
        }
    }

    // v2.1 - è¡Œç•ªå·ã‚’æŒ¯ã‚Šç›´ã™
    function updateRowNumbers() {
        document.querySelectorAll('.exp-row').forEach((row, i) => {
            row.querySelector('.exp-row-num').textContent = i + 1;
        });
    }

    // v2.1 - ã‚¬ã‚½ãƒªãƒ³ä»£è‡ªå‹•è¨ˆç®—ï¼ˆ100kmä»¥ä¸Šã§(km-100)Ã—30å††ï¼‰
    function updateGas(input) {
        const row = input.closest('.exp-row');
        const km = parseInt(input.value) || 0;
        const gas = km >= 100 ? (km - 100) * 30 : 0;
        row.querySelector('.exp-gas').value = gas || '';
        calcTotals();
    }

    // v2.1 - é«˜é€Ÿä»£ã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒ‘ãƒ¼ã‚¹
    function parseHighway(value) {
        if (!value) return 0;
        return value.split(/[,ã€ï¼Œ]/).reduce(
            (sum, v) => sum + (parseInt(v.trim()) || 0), 0
        );
    }

    // v2.1 - åˆè¨ˆé‡‘é¡è¨ˆç®—
    function calcTotals() {
        let grandTotal = 0;
        document.querySelectorAll('.exp-row').forEach(row => {
            const gas = parseInt(row.querySelector('.exp-gas').value) || 0;
            const hw = parseHighway(row.querySelector('.exp-highway').value);
            const ot = parseInt(row.querySelector('.exp-other').value) || 0;
            const sh = parseInt(row.querySelector('.exp-ship').value) || 0;
            const tr = parseInt(row.querySelector('.exp-train').value) || 0;
            const ai = parseInt(row.querySelector('.exp-air').value) || 0;
            const ho = parseInt(row.querySelector('.exp-hotel').value) || 0;
            const rowTotal = gas + hw + ot + sh + tr + ai + ho;
            row.querySelector('.exp-row-total-val').textContent =
                `Â¥${rowTotal.toLocaleString()}`;
            grandTotal += rowTotal;
        });
        const el = document.getElementById('expGrandTotal');
        if (el) el.textContent = `Â¥${grandTotal.toLocaleString()}`;
    }

    // v2.1 - å…¨è¡Œãƒ‡ãƒ¼ã‚¿ã‚’åé›†
    function collectRowData() {
        const rows = [];
        document.querySelectorAll('.exp-row').forEach(row => {
            rows.push({
                month: row.querySelector('.exp-month').value,
                day: row.querySelector('.exp-day').value,
                transport: row.querySelector('.exp-transport').value,
                distance: row.querySelector('.exp-distance').value,
                gasCost: row.querySelector('.exp-gas').value,
                highway: row.querySelector('.exp-highway').value,
                highwayCount: row.querySelector('.exp-hw-count').value,
                other: row.querySelector('.exp-other').value,
                ship: row.querySelector('.exp-ship').value,
                train: row.querySelector('.exp-train').value,
                air: row.querySelector('.exp-air').value,
                hotel: row.querySelector('.exp-hotel').value,
                hotelName: row.querySelector('.exp-hotel-name').value
            });
        });
        return rows;
    }

    // v2.1 - ä¸‹æ›¸ãä¿å­˜
    function saveDraft() {
        const draft = {
            submitDate: document.getElementById('expSubmitDate').value,
            ssName: document.getElementById('expSsName').value,
            destination: document.getElementById('expDestination').value,
            employeeName: document.getElementById('expEmployeeName').value,
            rows: collectRowData()
        };
        DataStorage.addExpense(draft);
        alert('ğŸ’¾ ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        loadDraftList();
    }

    // v2.1 - ä¸‹æ›¸ãä¸€è¦§è¡¨ç¤º
    function loadDraftList() {
        const expenses = DataStorage.getExpenses();
        const listEl = document.getElementById('expDraftList');
        if (!listEl) return;

        if (expenses.length === 0) {
            listEl.innerHTML =
                '<p class="empty-msg">ä¸‹æ›¸ãã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            return;
        }

        let html = '';
        expenses.forEach(d => {
            const dateStr = d.createdAt
                ? new Date(d.createdAt).toLocaleString('ja-JP') : '';
            html += `<div class="exp-draft-item">
                <div class="exp-draft-info"
                    onclick="ExpenseForm.loadDraft('${d.id}')">
                    <div class="exp-draft-title">
                        ${d.destination || 'ï¼ˆè¡Œå…ˆæœªå…¥åŠ›ï¼‰'}</div>
                    <div class="exp-draft-date">${dateStr}</div>
                </div>
                <button class="exp-draft-del"
                    onclick="ExpenseForm.deleteDraft('${d.id}')">
                    ğŸ—‘ï¸</button>
            </div>`;
        });
        listEl.innerHTML = html;
    }

    // v2.1 - ä¸‹æ›¸ãèª­ã¿è¾¼ã¿
    function loadDraft(id) {
        const expenses = DataStorage.getExpenses();
        const draft = expenses.find(e => e.id === id);
        if (!draft) { alert('ä¸‹æ›¸ããŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return; }
        if (!confirm('ç¾åœ¨ã®å…¥åŠ›ã‚’ç ´æ£„ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ')) return;

        document.getElementById('expSubmitDate').value =
            draft.submitDate || new Date().toISOString().split('T')[0];
        document.getElementById('expSsName').value =
            draft.ssName || 'åƒè‘‰è¥¿SS';
        document.getElementById('expDestination').value =
            draft.destination || '';
        document.getElementById('expEmployeeName').value =
            draft.employeeName || 'å°å‡ºæ™ƒä¹Ÿ';

        document.getElementById('expRows').innerHTML = '';
        rowCount = 0;

        if (draft.rows && draft.rows.length > 0) {
            draft.rows.forEach(rd => {
                addRow();
                const r = document.getElementById(`expRow-${rowCount}`);
                r.querySelector('.exp-month').value = rd.month || '';
                r.querySelector('.exp-day').value = rd.day || '';
                r.querySelector('.exp-transport').value = rd.transport || '';
                r.querySelector('.exp-distance').value = rd.distance || '';
                r.querySelector('.exp-gas').value = rd.gasCost || '';
                r.querySelector('.exp-highway').value = rd.highway || '';
                r.querySelector('.exp-hw-count').value = rd.highwayCount || '';
                r.querySelector('.exp-other').value = rd.other || '';
                r.querySelector('.exp-ship').value = rd.ship || '';
                r.querySelector('.exp-train').value = rd.train || '';
                r.querySelector('.exp-air').value = rd.air || '';
                r.querySelector('.exp-hotel').value = rd.hotel || '';
                r.querySelector('.exp-hotel-name').value = rd.hotelName || '';
            });
        } else { addRow(); }
        calcTotals();
        alert('ğŸ“‚ ä¸‹æ›¸ãã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
    }

    // v2.1 - ä¸‹æ›¸ãå‰Šé™¤
    function deleteDraft(id) {
        if (!confirm('ã“ã®ä¸‹æ›¸ãã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        DataStorage.deleteExpense(id);
        loadDraftList();
    }

    // v2.1 - ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
    function clearAll() {
        if (!confirm('ã™ã¹ã¦ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) return;
        document.getElementById('expDestination').value = '';
        document.getElementById('expRows').innerHTML = '';
        rowCount = 0;
        addRow();
        calcTotals();
    }

    // v2.1 - PDFç”Ÿæˆï¼ˆexpense-pdf.jsã«å§”è­²ï¼‰
    function generatePDF() {
        const formData = {
            submitDate: document.getElementById('expSubmitDate').value,
            ssName: document.getElementById('expSsName').value,
            destination: document.getElementById('expDestination').value,
            employeeName: document.getElementById('expEmployeeName').value
        };
        ExpensePdf.generate(formData, collectRowData());
    }

    return {
        init, addRow, deleteRow, updateGas, calcTotals,
        saveDraft, loadDraft, deleteDraft, loadDraftList,
        clearAll, generatePDF
    };
})();
```

---

## ä½œæ¥­3: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ â€” expense-pdf.js

ç²¾ç®—æ›¸PDFç”Ÿæˆå°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚ä»¥ä¸‹ã®å†…å®¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```javascript
// ============================================
// ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.1 - expense-pdf.js
// äº¤é€šè²»ç²¾ç®—æ›¸PDFç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ11åˆ—ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
// v2.1æ–°è¦ä½œæˆ - expense-form.jsã‹ã‚‰åˆ†é›¢
// html2canvas + jsPDF ã§ç²¾ç®—æ›¸ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†ç¾
// ============================================

const ExpensePdf = (() => {

    // v2.1 - é«˜é€Ÿä»£ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒ‘ãƒ¼ã‚¹
    function parseHighway(value) {
        if (!value) return 0;
        return value.split(/[,ã€ï¼Œ]/).reduce(
            (sum, v) => sum + (parseInt(v.trim()) || 0), 0
        );
    }

    // v2.1 - åˆè¨ˆæ–‡å­—åˆ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function fmt(v) {
        return v ? v + 'å††' : '';
    }

    // v2.1 - PDFç”Ÿæˆãƒ¡ã‚¤ãƒ³
    async function generate(formData, rowsData) {
        const loading = document.getElementById('loading');
        loading.style.display = 'flex';
        document.getElementById('loadingProgress').textContent = 'PDFç”Ÿæˆä¸­...';

        try {
            const pdfDiv = buildPdfHtml(formData, rowsData);
            document.body.appendChild(pdfDiv);
            await new Promise(r => setTimeout(r, 150));

            const canvas = await html2canvas(pdfDiv, {
                scale: 2, useCORS: true,
                logging: false, backgroundColor: '#ffffff'
            });
            document.body.removeChild(pdfDiv);

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('landscape', 'mm', 'a4');
            const imgData = canvas.toDataURL('image/png');
            const pdfW = pdf.internal.pageSize.getWidth();
            const pdfH = pdf.internal.pageSize.getHeight();
            const ratio = Math.min(
                (pdfW - 10) / canvas.width,
                (pdfH - 10) / canvas.height
            );
            const imgX = (pdfW - canvas.width * ratio) / 2;
            pdf.addImage(
                imgData, 'PNG', imgX, 5,
                canvas.width * ratio, canvas.height * ratio
            );

            const d = new Date(formData.submitDate);
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const dy = String(d.getDate()).padStart(2, '0');
            pdf.save(`äº¤é€šè²»ç²¾ç®—_${y}${m}${dy}.pdf`);
        } catch (err) {
            console.error('PDFç”Ÿæˆã‚¨ãƒ©ãƒ¼:', err);
            alert('PDFç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err.message);
        } finally {
            loading.style.display = 'none';
        }
    }

    // v2.1 - PDFç”¨HTMLæ§‹ç¯‰ï¼ˆ11åˆ—ãƒ†ãƒ¼ãƒ–ãƒ«å®Œå…¨å†ç¾ï¼‰
    function buildPdfHtml(formData, rowsData) {
        const dateObj = new Date(formData.submitDate);
        const year = dateObj.getFullYear();
        const month = dateObj.getMonth() + 1;
        const day = dateObj.getDate();
        const dest = formData.destination.replace(/\n/g, '<br>');

        const totals = {
            gasCost: 0, highway: 0, other: 0,
            ship: 0, train: 0, air: 0, hotel: 0, all: 0
        };

        let dataRowsHtml = '';
        rowsData.forEach(rd => {
            const gas = parseInt(rd.gasCost) || 0;
            const hw = parseHighway(rd.highway);
            const other = parseInt(rd.other) || 0;
            const ship = parseInt(rd.ship) || 0;
            const train = parseInt(rd.train) || 0;
            const air = parseInt(rd.air) || 0;
            const hotel = parseInt(rd.hotel) || 0;
            const rowTotal = gas + hw + other + ship + train + air + hotel;

            totals.gasCost += gas;
            totals.highway += hw;
            totals.other += other;
            totals.ship += ship;
            totals.train += train;
            totals.air += air;
            totals.hotel += hotel;
            totals.all += rowTotal;

            let distDisp = '';
            if (rd.distance) distDisp = rd.distance + 'ã‚­ãƒ­';
            if (gas) distDisp += '\n' + gas + 'å††';

            let hwDisp = '';
            if (rd.highway) {
                const amounts = rd.highway.split(/[,ã€ï¼Œ]/)
                    .map(v => v.trim()).filter(v => v);
                hwDisp = amounts.map(a => parseInt(a) + 'å††').join('\n');
                if (rd.highwayCount) hwDisp += '\n' + rd.highwayCount + 'æš';
            }

            let hotelDisp = '';
            if (hotel) {
                hotelDisp = hotel + 'å††';
                if (rd.hotelName) hotelDisp += '\n' + rd.hotelName;
            }

            const s = 'border:1px solid black;padding:3px 5px;'
                + 'text-align:center;vertical-align:middle;'
                + 'font-size:10px;height:50px;';

            dataRowsHtml += `<tr>
                <td style="${s}">${rd.month}</td>
                <td style="${s}">${rd.day}</td>
                <td style="${s}">${rd.transport}</td>
                <td style="${s}"><span class="cc">${distDisp}</span></td>
                <td style="${s}"><span class="cc">${hwDisp}</span></td>
                <td style="${s}">${other ? other + 'å††' : ''}</td>
                <td style="${s}">${ship ? ship + 'å††' : ''}</td>
                <td style="${s}">${train ? train + 'å††' : ''}</td>
                <td style="${s}">${air ? air + 'å††' : ''}</td>
                <td style="${s}"><span class="cc">${hotelDisp}</span></td>
                <td style="${s}">${rowTotal ? rowTotal + 'å††' : ''}</td>
            </tr>`;
        });

        const es = 'border:1px solid black;height:50px;';
        for (let i = rowsData.length; i < 6; i++) {
            dataRowsHtml += '<tr>' +
                `<td style="${es}"></td>`.repeat(11) + '</tr>';
        }

        const cs = 'border:1px solid black;padding:3px 5px;';
        const ch = cs + 'text-align:center;font-size:10px;';

        const div = document.createElement('div');
        div.style.cssText = `position:absolute;left:0;top:0;width:1050px;
            background:white;padding:20px 25px;z-index:9999;
            font-family:'MS Gothic','ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',
            'Hiragino Kaku Gothic ProN',sans-serif;font-size:11px;`;

        div.innerHTML = `
            <style>.cc{white-space:pre-line;line-height:1.3;}</style>
            <div style="font-size:13px;margin-bottom:10px;">
                æ—¥æœ¬ROãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚µãƒ¼ãƒ“ã‚¹æ ªå¼ä¼šç¤¾ã€€å¾¡ä¸­</div>
            <div style="text-align:center;font-size:20px;font-weight:bold;
                letter-spacing:8px;margin-bottom:12px;">
                å‡ºå¼µè²»ç²¾ç®—è«‹æ±‚æ›¸</div>
            <table style="width:100%;border-collapse:collapse;border:1px solid black;">
                <tr style="height:20px;">
                    <td style="${cs}">æå‡ºæ—¥</td>
                    <td colspan="5" style="${cs}text-align:left;padding-left:10px;">
                        ${year}å¹´ã€€ã€€${month}æœˆã€€ã€€${day}æ—¥</td>
                    <td style="${cs}">SSå</td>
                    <td colspan="2" style="${cs}">${formData.ssName}</td>
                    <td style="${cs}padding:0;height:20px;">
                        <table style="width:100%;height:100%;border-collapse:collapse;">
                        <tr><td style="border-right:1px solid black;width:50%;"></td>
                        <td style="width:50%;text-align:center;font-size:10px;">çµŒç†</td>
                        </tr></table></td>
                    <td style="${ch}">æœ¬éƒ¨</td>
                </tr>
                <tr>
                    <td colspan="2" style="${cs}height:40px;text-align:center;">
                        è¡Œå…ˆ<br><span style="font-size:8px;">ï¼ˆãŠå®¢æ§˜åï¼‰</span></td>
                    <td colspan="4" style="${cs}text-align:left;padding-left:10px;">
                        ${dest}</td>
                    <td style="${cs}text-align:center;">æ°å</td>
                    <td colspan="2" style="${cs}text-align:left;">
                        ${formData.employeeName}ã€€å°</td>
                    <td style="${cs}padding:0;height:40px;">
                        <table style="width:100%;height:100%;border-collapse:collapse;">
                        <tr><td style="border-right:1px solid black;width:50%;"></td>
                        <td style="width:50%;"></td></tr></table></td>
                    <td style="${cs}height:40px;"></td>
                </tr>
                <tr style="height:45px;">
                    <td style="${ch}width:40px;">æœˆ</td>
                    <td style="${ch}width:40px;">æ—¥</td>
                    <td style="${ch}width:90px;">åˆ©ç”¨äº¤é€šæ©Ÿé–¢</td>
                    <td style="${ch}width:70px;">èµ°è¡Œè·é›¢</td>
                    <td style="${ch}width:60px;">é«˜é€Ÿä»£<br>
                        <span style="font-size:8px;">ï¼ˆæšæ•°ï¼‰</span></td>
                    <td style="${ch}width:70px;">ãã®ä»–<br>
                        <span style="font-size:8px;">ï¼ˆã‚¿ã‚¯ã‚·ãƒ¼ãƒ»<br>ãƒã‚¹ç­‰ï¼‰</span></td>
                    <td style="${ch}width:55px;">èˆ¹è³ƒ</td>
                    <td style="${ch}width:55px;">é›»è»Šè³ƒ</td>
                    <td style="${ch}width:55px;">èˆªç©ºè³ƒ</td>
                    <td style="${ch}width:70px;">å®¿æ³Šæ–™<br>
                        <span style="font-size:8px;">ï¼ˆå®¿æ³Šå…ˆï¼‰</span></td>
                    <td style="${ch}width:60px;">åˆè¨ˆ</td>
                </tr>
                ${dataRowsHtml}
                <tr style="height:40px;">
                    <td colspan="2" style="${cs}text-align:center;font-weight:bold;">
                        åˆã€€ã€€è¨ˆ</td>
                    <td style="${cs}"></td>
                    <td style="${ch}">${fmt(totals.gasCost)}</td>
                    <td style="${ch}">${fmt(totals.highway)}</td>
                    <td style="${ch}">${fmt(totals.other)}</td>
                    <td style="${ch}">${fmt(totals.ship)}</td>
                    <td style="${ch}">${fmt(totals.train)}</td>
                    <td style="${ch}">${fmt(totals.air)}</td>
                    <td style="${ch}">${fmt(totals.hotel)}</td>
                    <td style="${ch}font-weight:bold;">${fmt(totals.all)}</td>
                </tr>
                <tr>
                    <td colspan="11" style="${cs}height:60px;text-align:left;
                        vertical-align:top;padding:6px;">
                        <span style="font-weight:bold;">ã€å‚™è€ƒæ¬„ã€‘</span></td>
                </tr>
            </table>`;

        return div;
    }

    return { generate };
})();
```

---

## ä½œæ¥­4: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” data-storage.js

ä»¥ä¸‹ã®å¤‰æ›´ã‚’è¡Œã†:

### 4-1. KEYSã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«expensesè¿½åŠ 
å…ˆé ­ã®KEYSå®šç¾©ã« `expenses: 'mm_expenses'` ã‚’è¿½åŠ ã™ã‚‹ã€‚

### 4-2. ç²¾ç®—æ›¸ãƒ‡ãƒ¼ã‚¿ç®¡ç†é–¢æ•°ã‚’è¿½åŠ ï¼ˆè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«è¿½åŠ ï¼‰
```javascript
    // --- ç²¾ç®—æ›¸ãƒ‡ãƒ¼ã‚¿ï¼ˆv2.1è¿½åŠ ï¼‰ ---

    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸ä¸‹æ›¸ãä¸€è¦§å–å¾—
    function getExpenses() {
        try {
            const data = localStorage.getItem(KEYS.expenses);
            return data ? JSON.parse(data) : [];
        } catch (e) {
            console.error('ç²¾ç®—æ›¸ãƒ‡ãƒ¼ã‚¿èª­è¾¼ã‚¨ãƒ©ãƒ¼:', e);
            return [];
        }
    }

    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸ä¸‹æ›¸ãä¿å­˜
    function saveExpenses(expenses) {
        try {
            localStorage.setItem(KEYS.expenses, JSON.stringify(expenses));
            return true;
        } catch (e) {
            console.error('ç²¾ç®—æ›¸ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
            alert('ç²¾ç®—æ›¸ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            return false;
        }
    }

    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸1ä»¶è¿½åŠ ï¼ˆæœ€å¤§20ä»¶ï¼‰
    function addExpense(expense) {
        const expenses = getExpenses();
        expense.id = expense.id || 'exp_' + Date.now();
        expense.createdAt = new Date().toISOString();
        expenses.unshift(expense);
        if (expenses.length > 20) expenses.splice(20);
        saveExpenses(expenses);
        return expense;
    }

    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸1ä»¶å‰Šé™¤
    function deleteExpense(id) {
        let expenses = getExpenses();
        expenses = expenses.filter(e => e.id !== id);
        saveExpenses(expenses);
    }
```

### 4-3. exportBackupé–¢æ•°ã®dataã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ 
`expenses: getExpenses()` ã‚’è¿½åŠ ã™ã‚‹ã€‚versionã‚’ `'2.1'` ã«ã™ã‚‹ã€‚

### 4-4. importBackupé–¢æ•°ã®v2.xå¾©å…ƒéƒ¨åˆ†ã«è¿½åŠ 
`if (data.expenses) saveExpenses(data.expenses);` ã‚’è¿½åŠ ã™ã‚‹ã€‚

### 4-5. resetAllé–¢æ•°ã«è¿½åŠ 
`localStorage.removeItem(KEYS.expenses);` ã‚’è¿½åŠ ã™ã‚‹ã€‚

### 4-6. returnæ–‡ã«è¿½åŠ 
`getExpenses, saveExpenses, addExpense, deleteExpense` ã‚’å…¬é–‹APIã«è¿½åŠ ã™ã‚‹ã€‚

---

## ä½œæ¥­5: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” index.html

### 5-1. titleã‚¿ã‚°ã‚’å¤‰æ›´
`ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.1` ã«ã™ã‚‹ã€‚

### 5-2. expense-styles.cssã®èª­ã¿è¾¼ã¿ã‚’è¿½åŠ 
styles.cssã®æ¬¡ã®è¡Œã«è¿½åŠ :
```html
    <link rel="stylesheet" href="expense-styles.css">
```

### 5-3. ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ v2.1 ã«ã—ã€featuresã«è¿½åŠ 
```html
<span>ğŸ’° äº¤é€šè²»ç²¾ç®—</span>
```

### 5-4. ä¸‹éƒ¨ãƒ‘ãƒãƒ«ã®tabsã«ç²¾ç®—æ›¸ã‚¿ãƒ–ã‚’è¿½åŠ 
é›†è¨ˆã‚¿ãƒ–ã®æ¬¡ã«:
```html
            <button class="tab" data-tab="expense" onclick="switchTab('expense')">ğŸ’° ç²¾ç®—æ›¸</button>
```

### 5-5. panel-contentå†…ã«ç²¾ç®—æ›¸ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ 
tabSummaryã®divã®æ¬¡ã«:
```html
            <div class="tab-content" id="tabExpense">
                <p class="empty-msg">ğŸ’° ç²¾ç®—æ›¸ã‚¿ãƒ–ã‚’é¸æŠã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
```

### 5-6. html2canvas CDNã‚’è¿½åŠ 
jspdf-autotableã®scriptã‚¿ã‚°ã®æ¬¡ã«:
```html
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
```

### 5-7. ã‚¢ãƒ—ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«2ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
route-manager.jsã®æ¬¡ã«:
```html
    <script src="expense-form.js"></script>
    <script src="expense-pdf.js"></script>
```

### 5-8. loadingã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ±ç”¨åŒ–
ã€ŒğŸ“ ä½æ‰€ã‚’å¤‰æ›ä¸­...ã€â†’ã€ŒğŸ“ å‡¦ç†ä¸­...ã€

---

## ä½œæ¥­6: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” ui-actions.js

### 6-1. switchTabé–¢æ•°ã«ç²¾ç®—æ›¸ã‚¿ãƒ–å¯¾å¿œã‚’è¿½åŠ 
summaryã®æ¡ä»¶ã®å¾Œã«:
```javascript
    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸ã‚¿ãƒ–ã‚’é–‹ã„ãŸã‚‰åˆæœŸåŒ–
    if (tabName === 'expense') {
        ExpenseForm.init();
    }

    // v2.1è¿½åŠ  - ç²¾ç®—æ›¸ã‚¿ãƒ–é¸æŠæ™‚ã¯ãƒ‘ãƒãƒ«ã‚’åºƒã’ã‚‹
    if (tabName === 'expense') {
        document.getElementById('bottomPanel').classList.remove('collapsed');
        document.getElementById('bottomPanel').style.maxHeight = '85vh';
    } else {
        document.getElementById('bottomPanel').style.maxHeight = '55vh';
    }
```

---

## ä½œæ¥­7: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” sw.js

### 7-1. CACHE_NAMEã‚’æ›´æ–°
`'maintenance-map-v2.1.0'` ã«ã™ã‚‹ã€‚

### 7-2. urlsToCacheã«3ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
```
'./expense-styles.css',
'./expense-form.js',
'./expense-pdf.js',
```

---

## ä½œæ¥­8: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” manifest.json

nameã‚’ `ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒãƒƒãƒ— v2.1` ã«ã™ã‚‹ã€‚
descriptionã‚’ `ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ã‚µãƒ¼ãƒãƒ¼ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å…ˆã‚’åœ°å›³ã§ç®¡ç†ï¼‹äº¤é€šè²»ç²¾ç®—æ›¸ä½œæˆã‚¢ãƒ—ãƒª` ã«ã™ã‚‹ã€‚

---

## ä½œæ¥­9: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ â€” styles.css

### 9-1. .bottom-panelã®transitionã«max-heightã‚’è¿½åŠ 
```css
    transition: transform 0.3s ease, max-height 0.3s ease;
```

### 9-2. .tabã®font-sizeã¨paddingã‚’èª¿æ•´ï¼ˆã‚¿ãƒ–4ã¤ã«ãªã‚‹ãŸã‚ï¼‰
```css
.tab {
    flex: 1; padding: 8px 4px;
    ...
    font-size: 12px;
    ...
    white-space: nowrap;
}
```

---

## ä½œæ¥­å®Œäº†å¾Œã®ç¢ºèª

1. `wc -l *.js *.css *.html` ã§å…¨ãƒ•ã‚¡ã‚¤ãƒ«500è¡Œä»¥å†…ã‚’ç¢ºèª
2. git add, commit, push ã™ã‚‹
3. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: `v2.1 ç²¾ç®—æ›¸æ©Ÿèƒ½çµ±åˆ - expense-form/pdf/stylesæ–°è¦ã€data-storage/index/ui-actions/sw/manifestä¿®æ­£`
